monetate.c.cr({"data": "if(document.querySelector('[aria-label=\"Search\"]')){\n   var search = document.querySelector('[aria-label=\"Search\"]');\n} else if (document.getElementById('searchbox')) {\n   var search = document.getElementById('searchbox');\n}\n//var submitButton = document.querySelectorAll('.r-unghlx.r-1loqt21.r-zx9znk.r-1sp51qo.r-bnwqim.r-1otgn73.r-eafdt9.r-1i6wzkk.r-lrvibr.r-5orghg')[0];\n\nvar pastSearches = [];\n\n//console.log(search);\n\nvar searchTerm = new URL(location.href).searchParams.get('searchTerm');\n\n/*\nvar searchTerm = \"\";\n\nif(document.querySelector('.css-901oao.r-1jn44m2.r-1ui5ee8.r-vw2c0b.r-1qhn6m8')) {\n   var searchTerm = document.querySelector('.css-901oao.r-1jn44m2.r-1ui5ee8.r-vw2c0b.r-1qhn6m8').innerText;\n\n  searchTerm = searchTerm.match(/\"([^']+)\"/)[1];\n  //searchTerm.replace(/['\"]+/g, '');\n} else if (document.querySelector('h1.css-4rbku5.css-901oao.r-cqee49.r-1ui5ee8.r-vw2c0b.r-16krg75.r-xnfwke.r-crgep1.r-t60dpp')) {\n   var searchTerm = document.querySelector('h1.css-4rbku5.css-901oao.r-cqee49.r-1ui5ee8.r-vw2c0b.r-16krg75.r-xnfwke.r-crgep1.r-t60dpp').innerText;\n}\n*/\n//console.log('this is the fancy searchTerm ' + searchTerm);\n//console.log(submitButton);\n\n\nif(searchTerm){\n  \n    //searchTerm.replace(/%20/g, \" \");\n    //console.log(searchTerm);\n\n      if(localStorage[\"pastSearches\"]) {\n          console.log(pastSearches);\n          console.log('we found past searches!');\n          //make variable called pastSearches to the json of the array\n          pastSearches = JSON.parse(localStorage[\"pastSearches\"]);\n\n          if (searchTerm.length > 1) {\n              if(pastSearches.indexOf(searchTerm) == -1) {\n                  pastSearches.unshift(searchTerm);\n              }\n              if(pastSearches.length > 7) { \n                  pastSearches.pop();\n              }\n\n              localStorage[\"pastSearches\"] = JSON.stringify(pastSearches);\n          }\n          //console.log(pastSearches);\n\n      //pastSearches = JSON.parse(sessionStorage[\"pastSearches\"]);\n      } else {\n      //we don't want to add nothing to recent searches\n          if (searchTerm.length > 1){\n              pastSearches.unshift(searchTerm);\n              localStorage[\"pastSearches\"] = JSON.stringify(pastSearches);\n          }\n\n      }\n      //console.log(searchTerm);\n     \n}\n    \n    \n    \n    //set event listeners on button and grab the search text\n    search.addEventListener(\"input\", function() {\n        if(this.value.length >=1) {\n            //console.log(\"val: \" + this.value);\n            if(document.getElementById(\"dropdownul\")) {\n                removeDropDownList();\n            }                \n        } else if (this.value.length < 1){\n            //console.log(\"no value\");\n            //only make dropdwon if there is past searches\n\t\t\t if(!document.getElementById(\"dropdownul\")) {\n               //console.log(\"no dropdown\");\n                \tcreateDropDownList();\n                }\n                \n        }\n    });\n\t\n\t// Attach click event to entire document\n    document.addEventListener(\"click\", function(e) {\n        removeDropDownList();\n    });\n\n\t// attach click event to input, tell event to stop propagating so it wont bubble\n\tsearch.addEventListener(\"click\", function(e){\n        e.stopPropagation();\n    });\n\n\t// event listener for when search field gets focus \n    search.addEventListener(\"focusin\", function() { \n        //console.log('input focus');\n        //console.log('focus val: ' + this.value);\n\n        if(!document.getElementById(\"dropdownul\") && this.value.length == 0) {\n            if(localStorage[\"pastSearches\"]) {\n                createDropDownList();\n            }\n        }            \n        \n    });\n\n\n\t// remove search item\n    function removeSearchItem(id, e){\n        //console.log(id);\n        //console.log(e);\n        pastSearches.splice(id,1);\n        console.log(pastSearches);\n        localStorage[\"pastSearches\"] = JSON.stringify(pastSearches);\n        //var next = e.parentNode.nextSibling;\n\n        e.parentNode.remove();\n      \n        //if(localStorage[\"pastSearches\"].length <= 1){\n        //  document.getElementById(\"recentSearchTitle\").remove();\n        //}\n        s.tl(true,'o','custom:shop:mt:recentsearch:removeone');\n    }\n\n    //remove all \n    function removeAllSearches() {\n        pastSearches = [];\n        localStorage[\"pastSearches\"] = JSON.stringify(pastSearches);\n        removeDropDownList();\n        s.tl(true,'o','custom:shop:mt:recentsearch:removeall');\n    }\n\n\n\n    // create dropdown list\n    function createDropDownList() {\n        //console.log('inside AGENT createDropDownList');\n        var dropdownul = document.createElement(\"ul\");\n            dropdownul.setAttribute(\"id\", \"dropdownul\");\n            dropdownul.setAttribute('class', 'recentSearchDropdown');\n            //search.insertBefore()(dropdownDiv);\n      \n      \t//var insert = document.querySelectorAll('.css-1dbjc4n.r-150rngu.r-14lw9ot.r-163hwi9.r-18u37iz.r-16y2uox.r-1wbh5a2.r-11yh6sk.r-1rnoaur.r-u8s1d.r-8eqzbf.r-1sncvnh.r-u3yave')[0];\n\n        \n        //var insert = document.querySelectorAll(\".css-1dbjc4n.r-1d2f490.r-1jgb5lz.r-1ge9hsw.r-u8s1d.r-zchlnj.r-da4fqn.r-13qz1uu.r-uejdgs\")[0];\n      \n      \n      \t \n      \n      if(document.querySelector('[aria-label=\"Search\"]')){\n        //any pages other than home\n        //var insert = document.querySelectorAll(\".css-1dbjc4n.r-1d2f490.r-1jgb5lz.r-1ge9hsw.r-u8s1d.r-zchlnj.r-da4fqn.r-13qz1uu.r-uejdgs\")[0];\n        //insert.prepend(dropdownul);\n       //var parent = document.querySelector('a[aria-label=\"Go To CVS home Page\"]').nextSibling.firstChild;\n        search.parentNode.parentNode.append(dropdownul);\n        \n        //also fix for overlap\n        \n  \t   document.querySelector('.css-1dbjc4n.r-18u37iz.r-1wtj0ep.r-1ge9hsw.r-utggzx.r-95jzfe.r-13qz1uu').style.zIndex = \"99999\";\n        document.querySelector('.css-1dbjc4n.r-1awozwy.r-1kihuf0.r-14lw9ot.r-eqz5dr.r-1wtj0ep.r-13qz1uu').parentNode.parentNode.style.zIndex = \"99999\";\n        \n        //insert.prepend(dropdownul);\n    } else if (document.getElementById('searchbox')) {\n      \tdropdownul.classList.add(\"recentSearchDropdown__home\");\n      \tsearch.parentNode.append(dropdownul);\n    }\n      \n      \t\n\n        \n        //var parent = insert.parentNode;\n            //parent.insertBefore(dropdownul, parent.firstElementChild.nextSibling);\n\t\t\n        var fragment = document.createDocumentFragment();\n\n            //console.log(\"THIS IS PAST SEARCHES \" + pastSearches);\n\n            if(localStorage[\"pastSearches\"]) {\n              \n                pastSearches = JSON.parse(localStorage[\"pastSearches\"]);\n              \n                if(pastSearches.length >= 1) {\n                  \n                  //adding adobe tracking\n                  s.tl(true,'o','custom:shop:mt:recentsearch:displaylist');\n              \n                  //first lets add a title li\n                  var titleli = document.createElement('li');\n                  titleli.setAttribute(\"class\", \"recentSearchTitle\");\n                  titleli.id = \"recentSearchTitle\";\n                  titleli.textContent = \"Recently searched\";\n\n                  fragment.appendChild(titleli);\n                }\n\n           \n\n                pastSearches.forEach(function(pastSearch, index) {\n                    var li = document.createElement('li');\n                    var a = document.createElement('a');\n                    a.setAttribute(\"class\", \"recentSearchLink\");\n                    a.textContent = pastSearch;\n                    a.setAttribute(\"tabindex\", 0);\n                    a.href = \"https://www.cvs.com/search?searchTerm=\" + pastSearch + \"&icid=mt_recent_search\";\n                  \n                    a.addEventListener('click',function(e){\n                        e.stopPropagation();\n                    });\n                    \n                    li.appendChild(a);\n\n                    var remove = document.createElement('a');\n                    //remove.value = \"Remove \" + pastSearch;\n                    //remove.type = \"button\";\n                    remove.setAttribute(\"id\", index);\n                    remove.setAttribute(\"class\", \"removeSearchItem\");\n                    remove.setAttribute(\"aria-label\", \"remove \" + pastSearch);\n                    remove.setAttribute(\"tabindex\", 0);\n                    remove.addEventListener(\"click\", function(e){ \n                        e.stopPropagation();\n                        removeSearchItem(index, this);\n                    });\n                  \n                    //keypress for remove link in case user selects enter\n                    remove.addEventListener(\"keypress\", function(e){\n                        removeSearchItem(index, this);\n                    });\n\n                    li.appendChild(remove);\n\n                    \n                    fragment.appendChild(li);\n                });\n            }\n\n            dropdownul.appendChild(fragment);\n\n            //create remove all\n\n            //console.log(pastSearches.length + \" PAST SEARCHES\");\n\n            if(pastSearches.length >= 2) {\n                var removeAll = document.createElement('li');\n                var removeAllLink = document.createElement('a');\n                removeAllLink.setAttribute(\"class\", \"removeAllLink\");\n                removeAllLink.textContent = \"Clear search history\";\n                removeAllLink.setAttribute(\"tabindex\", 0);\n                removeAll.appendChild(removeAllLink);\n                dropdownul.appendChild(removeAll);\n              \n               \n                removeAll.addEventListener(\"click\", function(e){\n                    e.stopPropagation();\n                    removeAllSearches();\n                });\n              \n                removeAll.addEventListener(\"keypress\", function(){ \n                    removeAllSearches();\n                });\n            }\n      \n    }\n\n\n    // remove dropdown list\n    function removeDropDownList() {\n        \n        if(document.getElementById(\"dropdownul\") != null) { \n          document.getElementById(\"dropdownul\").remove();\n          //document.getElementById(\"removeDropDownTitle\").remove();\n          \n          if(document.querySelector('[aria-label=\"Search\"]')){\n            document.querySelector('.css-1dbjc4n.r-18u37iz.r-1wtj0ep.r-1ge9hsw.r-utggzx.r-95jzfe.r-13qz1uu').style.zIndex = \"0\";\n            document.querySelector('.css-1dbjc4n.r-1awozwy.r-1kihuf0.r-14lw9ot.r-eqz5dr.r-1wtj0ep.r-13qz1uu').parentNode.parentNode.style.zIndex = \"0\";\n          }\n        \n        }\n\n    }\n\n    /*\n    search.addEventListener(\"blur\", function() {\n        console.log(\"blur\");\n        if(document.getElementById(\"dropdownul\") && search.value.length<=1) {\n\n            window.setTimeout(removeDropDownList, 200);\n        }\n        \n        */\n        \n  ", "ref": "306/3144449.js"});